#!/bin/bash
set -e

VERSION="v1.5-final"

# –û—á–∏—Å—Ç–∫–∞ —ç–∫—Ä–∞–Ω–∞
clear

# –¶–≤–µ—Ç–∞
GREEN='\033[1;32m'
CYAN='\033[1;36m'
NC='\033[0m' # —Å–±—Ä–æ—Å —Ü–≤–µ—Ç–∞

# üé® –ö—Ä–∞—Å–∏–≤—ã–π –±–∞–Ω–Ω–µ—Ä
echo ""
echo "  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñÑ‚ñÑ‚ñÑ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñì ‚ñà‚ñà‚ñÄ‚ñà‚ñà‚ñà  ‚ñì‚ñà‚ñà‚ñà‚ñà‚ñà   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ";
echo "‚ñí‚ñà‚ñà    ‚ñí ‚ñì  ‚ñà‚ñà‚ñí ‚ñì‚ñí‚ñì‚ñà‚ñà ‚ñí ‚ñà‚ñà‚ñí‚ñì‚ñà   ‚ñÄ ‚ñí‚ñà‚ñà    ‚ñí ‚ñí‚ñà‚ñà    ‚ñí ";
echo "‚ñë ‚ñì‚ñà‚ñà‚ñÑ   ‚ñí ‚ñì‚ñà‚ñà‚ñë ‚ñí‚ñë‚ñì‚ñà‚ñà ‚ñë‚ñÑ‚ñà ‚ñí‚ñí‚ñà‚ñà‚ñà   ‚ñë ‚ñì‚ñà‚ñà‚ñÑ   ‚ñë ‚ñì‚ñà‚ñà‚ñÑ   ";
echo "  ‚ñí   ‚ñà‚ñà‚ñí‚ñë ‚ñì‚ñà‚ñà‚ñì ‚ñë ‚ñí‚ñà‚ñà‚ñÄ‚ñÄ‚ñà‚ñÑ  ‚ñí‚ñì‚ñà  ‚ñÑ   ‚ñí   ‚ñà‚ñà‚ñí  ‚ñí   ‚ñà‚ñà‚ñí";
echo "‚ñí‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí  ‚ñí‚ñà‚ñà‚ñí ‚ñë ‚ñë‚ñà‚ñà‚ñì ‚ñí‚ñà‚ñà‚ñí‚ñë‚ñí‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí";
echo "‚ñí ‚ñí‚ñì‚ñí ‚ñí ‚ñë  ‚ñí ‚ñë‚ñë   ‚ñë ‚ñí‚ñì ‚ñë‚ñí‚ñì‚ñë‚ñë‚ñë ‚ñí‚ñë ‚ñë‚ñí ‚ñí‚ñì‚ñí ‚ñí ‚ñë‚ñí ‚ñí‚ñì‚ñí ‚ñí ‚ñë";
echo "‚ñë ‚ñë‚ñí  ‚ñë ‚ñë    ‚ñë      ‚ñë‚ñí ‚ñë ‚ñí‚ñë ‚ñë ‚ñë  ‚ñë‚ñë ‚ñë‚ñí  ‚ñë ‚ñë‚ñë ‚ñë‚ñí  ‚ñë ‚ñë";
echo "‚ñë  ‚ñë  ‚ñë    ‚ñë        ‚ñë‚ñë   ‚ñë    ‚ñë   ‚ñë  ‚ñë  ‚ñë  ‚ñë  ‚ñë  ‚ñë  ";
echo "      ‚ñë              ‚ñë        ‚ñë  ‚ñë      ‚ñë        ‚ñë  ";
echo ""

echo -e "${GREEN}–í–µ—Ä—Å–∏—è —Å–∫—Ä–∏–ø—Ç–∞: $VERSION${NC}"
echo -n "üöÄ –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞"; for i in {1..5}; do echo -n "."; sleep 0.3; done; echo -e "\n"

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
PASS="Str3\$\$0zz!98!"
PORT="11953"

echo -e "${GREEN}1Ô∏è‚É£ –û—Ç–∫–ª—é—á–∞–µ–º –ø–∏–Ω–≥ (ICMP echo-request)...${NC}"
sudo nft add table inet filter 2>/dev/null
sudo nft add chain inet filter input '{ type filter hook input priority 0; policy accept; }' 2>/dev/null
sudo nft add rule inet filter input icmp type echo-request drop
sudo nft list ruleset | sudo tee /etc/nftables.conf > /dev/null
sudo systemctl enable nftables
sudo mkdir -p /etc/systemd/system/nftables.service.d
echo -e '[Service]\nExecStart=\nExecStart=/usr/sbin/nft -f /etc/nftables.conf' | sudo tee /etc/systemd/system/nftables.service.d/override.conf > /dev/null
sudo systemctl daemon-reexec
sudo systemctl restart nftables

echo -e "${GREEN}2Ô∏è‚É£ –ú–µ–Ω—è–µ–º SSH-–ø–æ—Ä—Ç –Ω–∞ ${CYAN}${PORT}${NC}${GREEN}...${NC}"
sudo sed -i "s/^#Port 22/Port $PORT/" /etc/ssh/sshd_config
sudo systemctl restart sshd

echo -e "${GREEN}3Ô∏è‚É£ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–∞—Ä–æ–ª—å root...${NC}"
echo "root:$PASS" | sudo chpasswd

# –§–∏–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
IP=$(hostname -I | awk '{print $1}')
echo -e "${GREEN}‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!${NC}"
echo -e "${GREEN}=============================="
echo -e "üåê IP —Å–µ—Ä–≤–µ—Ä–∞: ${CYAN}${IP}${NC}"
echo -e "üì¶ –ü–æ—Ä—Ç SSH:   ${CYAN}${PORT}${NC}"
echo -e "üîë –ü–∞—Ä–æ–ª—å root: ${CYAN}${PASS}${NC}"
echo -e "==============================${NC}"
